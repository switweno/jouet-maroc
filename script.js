function preloadImages(e){if(!e||!e.length)return;let t=[];return e.forEach(e=>{let o=new Image;o.src=e,t.push(o)}),t}function changeImage(e,t=null){if(!e)return;let o=document.getElementById("current-image");if(!o)return;if(!t){let r=Array.from(document.querySelectorAll(".thumbnail")),l=r.findIndex(e=>e.classList.contains("active")),n=r.findIndex(t=>t.src===e);t=-1!==l&&-1!==n?n>l?"right":"left":"fade"}let a=o.src,i=e,s=new Image;s.src=i,s.onload=()=>{let r=o.parentNode,l=r.querySelector(".sliding-images-container");l||((l=document.createElement("div")).className="sliding-images-container",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.width="100%",l.style.height="100%",l.style.overflow="hidden",l.style.zIndex="2",l.style.willChange="transform, opacity",r.style.position="relative",r.appendChild(l));let n=document.createElement("img");n.src=a,n.className="exiting-image",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.objectFit="cover",n.style.zIndex="1",n.style.willChange="transform, opacity",l.appendChild(n);let s=document.createElement("img");s.src=i,s.className="entering-image",s.style.position="absolute",s.style.top="0",s.style.width="100%",s.style.height="100%",s.style.objectFit="cover",s.style.zIndex="2",s.style.willChange="transform, opacity","right"===t?s.style.transform="translateX(100%)":"left"===t?s.style.transform="translateX(-100%)":s.style.opacity="0",l.appendChild(s),animateTransition(n,s,t,()=>{for(o.src=i;l.firstChild;)l.removeChild(l.firstChild);updateActiveThumbnail(e)})}}function animateTransition(e,t,o,r){let l=performance.now();function n(a){let i=Math.min((a-l)/300,1);"right"===o?(e.style.transform=`translateX(-${100*i}%)`,t.style.transform=`translateX(${(1-i)*100}%)`):"left"===o?(e.style.transform=`translateX(${100*i}%)`,t.style.transform=`translateX(-${(1-i)*100}%)`):(e.style.opacity=1-i,t.style.opacity=i),i<1?requestAnimationFrame(n):r()}requestAnimationFrame(n)}function updateActiveThumbnail(e){let t=document.querySelectorAll(".thumbnail");t.forEach(t=>{t.classList.remove("active"),t.src===e&&(t.classList.add("active"),t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}))})}function updateQuantity(e){let t=document.getElementById("quantity"),o=parseInt(t.value);(o+=e)<1&&(o=1),o>10&&(o=10),t.value=o}function scrollToForm(){openOrderFormModal()}function openOrderFormModal(){let e=document.getElementById("order-form-modal");e.style.display="block",document.body.style.overflow="hidden"}function closeOrderFormModal(){let e=document.getElementById("order-form-modal");e.style.display="none",document.body.style.overflow="auto"}function getCurrentProductData(){let e=new URLSearchParams(window.location.search),t=e.get("product");return t||(t="trottinette-ecoxtrem-m4-max"),products.find(e=>e.id===t)||products[0]}function submitFormViaWhatsApp(e){e.preventDefault();try{let t=document.getElementById("name").value,o=document.getElementById("phone").value,r=document.getElementById("address").value,l=document.getElementById("city").value,n=parseInt(document.getElementById("quantity").value);if(!t||!o||!r||!l){alert("الرجاء ملء جميع الحقول المطلوبة");return}if(!/^[\d+]+$/.test(o.replace(/\s+/g,""))){alert("رقم الهاتف يجب أن يحتوي على أرقام فقط ورمز + إذا كان دوليًا");return}let a=getCurrentProductData(),i=document.querySelector(".product-title").textContent,s=a.currentPrice,c=document.getElementById("current-image").src,d=s,u=!1;a.wholesalePrice&&a.wholesalePrice.minQuantity&&a.wholesalePrice.pricePerUnit&&n>=a.wholesalePrice.minQuantity&&(d=a.wholesalePrice.pricePerUnit,u=!0);let p=n*d;document.getElementById("summary-product-image").src=c,document.getElementById("summary-product-name").textContent=i,u?document.getElementById("summary-product-price").innerHTML=`<span>${d} درهم</span> <small class="wholesale-label">(سعر الجملة)</small>`:document.getElementById("summary-product-price").textContent=d+" درهم",document.getElementById("summary-product-quantity").textContent=n,document.getElementById("summary-total-price").textContent=p+" درهم",document.getElementById("summary-customer-name").textContent=t,document.getElementById("summary-customer-phone").textContent=o,document.getElementById("summary-customer-address").textContent=r,document.getElementById("summary-customer-city").textContent=l;let m=document.getElementById("confirmation-modal");m.style.display="block",closeOrderFormModal(),document.body.style.overflow="hidden",document.getElementById("confirm-order-btn").onclick=function(){try{let e=u?`السعر: ${d} درهم (سعر الجملة)`:`السعر: ${d} درهم`,s=encodeURIComponent(`*طلب جديد*

*معلومات العميل:*
الاسم: ${t}
رقم الهاتف: ${o}
العنوان: ${r}
المدينة: ${l}
*تفاصيل الطلب:*
المنتج: ${i}
الكمية: ${n}
${e}
المجموع: ${p} درهم`);"function"==typeof fbq&&fbq("track","Purchase",{value:p,currency:"MAD",content_name:i,content_type:"product",content_ids:[a.id],contents:[{id:a.id,quantity:n,item_price:d}]}),closeConfirmationModal(),window.open(`https://wa.me/212762609147?text=${s}`,"_blank"),document.getElementById("order-form").reset()}catch(c){console.error("Error sending WhatsApp message:",c),alert("حدث خطأ أثناء محاولة الاتصال بواتساب. يرجى المحاولة مرة أخرى.")}},document.getElementById("cancel-order-btn").onclick=function(){closeConfirmationModal()},m.onclick=function(e){e.target===m&&closeConfirmationModal()}}catch(y){console.error("Error in form submission:",y),alert("حدث خطأ أثناء معالجة النموذج. يرجى المحاولة مرة أخرى.")}}function closeConfirmationModal(){document.getElementById("confirmation-modal").style.display="none",document.body.style.overflow="auto"}function submitForm(e){e.preventDefault();let t=document.getElementById("name").value,o=document.getElementById("phone").value;document.getElementById("address").value,document.getElementById("city").value;let r=document.getElementById("quantity").value;alert(`شكرا ${t}!
تم استلام طلبك بنجاح.
سنتواصل معك قريبًا على الرقم ${o} لتأكيد الطلب.`),"function"==typeof fbq&&fbq("track","Purchase",{value:parseFloat(document.querySelector(".current-price").textContent),currency:"MAD",content_name:document.querySelector(".product-title").textContent,content_type:"product",content_ids:["PROD12345"],contents:[{id:"PROD12345",quantity:parseInt(r),item_price:parseFloat(document.querySelector(".current-price").textContent)}]}),document.getElementById("order-form").reset()}function startDrag(e){e.preventDefault(),isDragging=!0,"mousedown"===e.type?(startX=e.clientX,startY=e.clientY):"touchstart"===e.type&&(startX=e.touches[0].clientX,startY=e.touches[0].clientY)}function drag(e){if(!isDragging)return;e.preventDefault();let t,o;"mousemove"===e.type?(t=e.clientX,o=e.clientY):"touchmove"===e.type&&(t=e.touches[0].clientX,o=e.touches[0].clientY);let r=t-startX,l=o-startY,n=window.innerWidth<=767,a=n?.8:1;if(zoomLevel>1){translateX+=r*a,translateY+=l*a;let i=.85*window.innerWidth,s=.75*window.innerHeight,c=document.getElementById("modal-image");if(c){let d=c.offsetWidth*zoomLevel,u=c.offsetHeight*zoomLevel,p=Math.max(0,(d-i)/2),m=Math.max(0,(u-s)/2);translateX=Math.min(Math.max(translateX,-p),p),translateY=Math.min(Math.max(translateY,-m),m)}updateImageTransform()}startX=t,startY=o}function endDrag(){isDragging=!1}function forceScrollToTop(){window.scrollTo&&window.scrollTo(0,0),document.documentElement&&(document.documentElement.scrollTop=0),document.body&&(document.body.scrollTop=0)}function setupProductLinks(){document.querySelectorAll(".related-products .product-link").forEach(e=>{e.onclick=null,e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),this.style.pointerEvents="none";let t=this.getAttribute("href"),o=new URLSearchParams(t.split("?")[1]).get("product");o?(document.body.style.cursor="wait",history.pushState({},"",`?product=${o}`),window.scrollTo(0,0),setTimeout(()=>{document.documentElement.scrollTop=0,document.body.scrollTop=0,setTimeout(()=>{loadProductFromURL(),this.style.pointerEvents="auto",document.body.style.cursor="default"},100)},50)):this.style.pointerEvents="auto"}),e.style.cursor="pointer"})}function setupAccordion(){document.querySelectorAll(".accordion-header").forEach(e=>{let t=e.cloneNode(!0);e.parentNode&&e.parentNode.replaceChild(t,e)}),document.querySelectorAll(".accordion-header").forEach(e=>{let t=e.parentElement,o=e.querySelector(".accordion-toggle");if(e.addEventListener("click",function(e){let r="A"===e.target.tagName||e.target.closest("a"),l="BUTTON"===e.target.tagName&&e.target!==o&&!o.contains(e.target);!r&&!l&&(toggleAccordionItem(t,o),e.preventDefault(),e.stopPropagation())}),o){o.addEventListener("click",function(e){toggleAccordionItem(t,this),e.preventDefault(),e.stopPropagation()});let r=t.classList.contains("expanded");o.setAttribute("aria-expanded",r?"true":"false")}})}function toggleAccordionItem(e,t){e.classList.contains("expanded"),document.querySelectorAll(".feature-category.expanded").forEach(t=>{if(t!==e){t.classList.remove("expanded");let o=t.querySelector(".accordion-toggle");o&&o.setAttribute("aria-expanded","false")}}),e.classList.toggle("expanded"),t&&t.setAttribute("aria-expanded",e.classList.contains("expanded")?"true":"false")}window.addEventListener("click",function(e){let t=document.getElementById("order-form-modal");e.target===t&&closeOrderFormModal()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&(closeOrderFormModal(),closeConfirmationModal())}),document.addEventListener("keydown",function(e){"Escape"===e.key&&closeConfirmationModal()});let firstLoad=!0;function setupThumbnailScrolling(){let e=document.querySelector(".thumbnails");if(!e)return;e.style.touchAction&&(e.style.touchAction="");let t=document.querySelectorAll(".thumbnail"),o=Array.from(t).map(e=>e.src);preloadImages(o),firstLoad=!1}function setupThumbnailScrolling(){let e=document.querySelector(".thumbnails");if(!e)return;e.style.scrollBehavior="smooth";let t=document.querySelectorAll(".thumbnail"),o=Array.from(t).map(e=>e.src);preloadImages(o),t.forEach((e,o)=>{e.addEventListener("click",function(e){e.stopPropagation();let r=document.querySelector(".thumbnail.active");if(r){let l=Array.from(t).indexOf(r);changeImage(this.src,o>l?"right":"left")}else changeImage(this.src)})}),firstLoad=!1}function loadProductFromURL(){try{window.scrollTo(0,0),document.documentElement.scrollTop=0,document.body.scrollTop=0;let e=new URLSearchParams(window.location.search),t=e.get("product");t||(t="trottinette-ecoxtrem-m4-max");let o=products.find(e=>e.id===t),r=o||products[0];if(!r){console.error("No product data available");return}document.title=r.title+" | jouet maroc",cleanupEventHandlers(),updateProductDisplay(r),updateRelatedProducts(),setTimeout(()=>{setupAccordion(),setupThumbnailScrolling(),setupProductLinks()},50)}catch(l){console.error("Error loading product:",l)}}function cleanupEventHandlers(){let e=document.querySelectorAll(".thumbnail, .product-link");e.forEach(e=>{let t=e.cloneNode(!0);e.parentNode&&e.parentNode.replaceChild(t,e)});let t=document.getElementById("current-image");if(t){let o=t.parentNode;if(o){let r=o.cloneNode(!0),l=o.querySelectorAll(".scroll-arrow");l.forEach(e=>{r.querySelector(`.scroll-arrow.${e.classList[1]}`).onclick=e.onclick}),o.parentNode.replaceChild(r,o)}}}let updateProductDisplay=function(e){document.querySelector(".product-title").textContent=e.title,document.querySelector(".product-brand").innerHTML=`
        <span style="color: #4b4b4b; font-weight: 600;">العلامة التجارية:</span>
        <span style="color: #4b4b4b; margin-right: 5px;">${e.brand}</span>
    `,document.querySelector(".product-category").innerHTML=`
        <span style="color: #4b4b4b; font-weight: 600;">الفئة:</span>
        <span style="color: #4b4b4b; margin-right: 5px;">${e.category}</span>
    `,document.querySelector(".product-availability").textContent=e.availability;var t=document.querySelector(".product-availability");"متوفر في المخزون"===e.availability?(t.style.color="#14b93a",t.style.fontSize="1.0rem"):"غير متوفر في المخزون"===e.availability?(t.style.color="#ff0000",t.style.fontSize="1rem"):(t.style.color="#000",t.style.fontSize="1rem");let o=document.querySelector(".ratings");o.innerHTML="";let r=Math.floor(e.ratings);for(let l=0;l<r;l++){let n=document.createElement("i");n.classList.add("fas","fa-star"),o.appendChild(n)}if(e.ratings%1>=.5){let a=document.createElement("i");a.classList.add("fas","fa-star-half-alt"),o.appendChild(a)}let i=document.createElement("span");i.textContent=`(${e.reviewCount} تقييم)`,o.appendChild(i),document.querySelector(".current-price").textContent=e.currentPrice+" درهم",document.querySelector(".old-price").textContent=e.oldPrice+" درهم",document.querySelector(".discount").textContent="خصم "+e.discount+"%";let s=document.getElementById("current-image");s.src=e.images[0];let c=document.querySelector(".main-image"),d=c.querySelector(".main-image-discount-badge");if(d&&d.remove(),e.discount){let u=document.createElement("div");u.className="main-image-discount-badge",u.textContent=`-${e.discount}%`,c.appendChild(u)}let p=document.querySelector(".product-wholesale-price"),m=document.getElementById("wholesale-price-value");e.wholesalePrice?(p.style.display="block",m.textContent=`${e.wholesalePrice.pricePerUnit} درهم (ابتداء من ${e.wholesalePrice.minQuantity} قطع)`):p.style.display="none";let y=document.getElementById("thumbnails-slider");y.innerHTML="",e.images.forEach((e,t)=>{let o=document.createElement("img");o.classList.add("thumbnail"),0===t&&o.classList.add("active"),o.src=e,o.alt=`صورة مصغرة ${t+1}`,o.onclick=function(){let e=document.querySelector(".thumbnail.active");if(e){let o=Array.from(document.querySelectorAll(".thumbnail")).indexOf(e);changeImage(this.src,t>o?"right":"left")}else changeImage(this.src)},o.style.cursor="pointer",o.style.pointerEvents="auto",o.style.touchAction="manipulation",y.appendChild(o)});let f=document.querySelector(".features-container"),g=document.querySelector(".feature-highlight").cloneNode(!0);if(f.innerHTML="",e.features.forEach((e,t)=>{let o=document.createElement("div");o.classList.add("feature-category"),0===t&&o.classList.add("expanded");let r=document.createElement("div");r.classList.add("accordion-header","french-heading");let l=document.createElement("h4");l.innerHTML=`<i class="fas ${e.icon}"></i> ${e.title}`;let n=document.createElement("button");n.classList.add("accordion-toggle"),n.innerHTML='<i class="fas fa-chevron-down"></i>',n.setAttribute("aria-label",`توسيع قسم ${e.title}`),n.setAttribute("aria-expanded",0===t?"true":"false"),r.appendChild(l),r.appendChild(n);let a=document.createElement("div");a.classList.add("accordion-content");let i=document.createElement("ul");i.classList.add("feature-list"),e.items.forEach(e=>{let t=document.createElement("li");t.classList.add("feature-item"),t.innerHTML=`<strong>${e.key}:</strong> ${e.value}`,i.appendChild(t)}),a.appendChild(i),o.appendChild(r),o.appendChild(a),f.appendChild(o)}),f.appendChild(g),document.querySelector(".feature-highlight span").textContent=e.warranty,e.videoURL){let h=document.querySelector(".video-container");"trottinette-bison-gt-1000"===e.id?h.classList.add("portrait-video"):h.classList.remove("portrait-video"),h.innerHTML=`
            <iframe 
                src="${e.videoURL}" 
                width="${"trottinette-bison-gt-1000"===e.id?"267":"560"}" 
                height="${"trottinette-bison-gt-1000"===e.id?"476":"314"}" 
                style="border:none;overflow:hidden" 
                scrolling="no" 
                frameborder="0" 
                allowfullscreen="true" 
                allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share">
            </iframe>
        `}let v=document.querySelector(".product-video-section");if(e.videoURL){let E=document.querySelector(".video-container");"trottinette-bison-gt-1000"===e.id?E.classList.add("portrait-video"):E.classList.remove("portrait-video"),E.innerHTML=`
        <iframe 
            src="${e.videoURL}" 
            width="${"trottinette-bison-gt-1000"===e.id?"267":"560"}" 
            height="${"trottinette-bison-gt-1000"===e.id?"476":"314"}" 
            style="border:none;overflow:hidden" 
            scrolling="no" 
            frameborder="0" 
            allowfullscreen="true" 
            allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share">
        </iframe>
    `,v.style.display="block"}else document.querySelector(".product-video-section").style.display="none";setTimeout(()=>{setupAccordion();let e=document.querySelector(".feature-category");if(e&&!e.classList.contains("expanded")){let t=e.querySelector(".accordion-toggle");toggleAccordionItem(e,t)}setupMainImageTouch()},200)};function setupProductLinks(){document.querySelectorAll(".product-link").forEach(e=>{e.addEventListener("click",function(e){let t=new URLSearchParams(this.href.split("?")[1]).get("product");t&&sessionStorage.setItem("scrollPosition",window.pageYOffset)})})}function setupProductLinks(){document.querySelectorAll(".related-products .product-link").forEach(e=>{e.onclick=null,e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),document.body.style.pointerEvents="none";let t=this.getAttribute("href"),o=new URLSearchParams(t.split("?")[1]).get("product");o?(history.pushState({},"",`?product=${o}`),window.scrollTo({top:0,left:0,behavior:"smooth"}),setTimeout(()=>{loadProductFromURL(),document.body.style.pointerEvents="auto"},400)):document.body.style.pointerEvents="auto"},{once:!0}),e.style.cursor="pointer",e.style.webkitTapHighlightColor="transparent"})}function updateRelatedProducts(){let e=document.querySelectorAll(".related-products .product-link");e.forEach(e=>{let t=e.getAttribute("href"),o=new URLSearchParams(t.split("?")[1]).get("product");if(o){let r=products.find(e=>e.id===o);if(r){let l=e.querySelector("h3");l&&(l.textContent=r.title);let n=e.querySelector("img");n&&r.images.length>0&&(n.src=r.images[0],n.alt=r.title);let a=e.querySelector(".related-price");a&&(a.textContent=r.currentPrice+" درهم");let i=e.querySelector(".related-old-price");i&&(i.textContent=r.oldPrice+" درهم");let s=e.querySelector(".related-discount-badge");s&&(s.textContent="-"+r.discount+"%")}}})}document.addEventListener("DOMContentLoaded",function(){try{loadProductFromURL(),setupProductLinks(),document.querySelector(".thumbnail")&&document.querySelector(".thumbnail").classList.add("active");let e=document.getElementById("modal-image");e&&(e.addEventListener("mousedown",startDrag),e.addEventListener("touchstart",startDrag,{passive:!1}),window.addEventListener("mousemove",drag),window.addEventListener("touchmove",drag,{passive:!1}),window.addEventListener("mouseup",endDrag),window.addEventListener("touchend",endDrag));let t=document.getElementById("image-modal");t&&t.addEventListener("click",function(e){e.target===t&&closeImageModal()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&"block"===t.style.display&&closeImageModal()});let o=0;e&&e.addEventListener("touchend",function(e){let t=new Date().getTime(),r=t-o;r<300&&r>0&&(1===zoomLevel?changeZoom(1):resetZoom(),e.preventDefault()),o=t}),document.addEventListener("keydown",function(e){let t=document.getElementById("image-modal");"block"===t.style.display&&("ArrowLeft"===e.key?(navigateImages(-1),e.preventDefault()):"ArrowRight"===e.key&&(navigateImages(1),e.preventDefault()))}),setupAccordion(),setupThumbnailScrolling(),document.querySelectorAll("img").forEach(e=>{e.onerror=function(){this.src="placeholder.jpg"}}),sessionStorage.getItem("scrollPosition")&&(window.scrollTo(0,parseInt(sessionStorage.getItem("scrollPosition"))),sessionStorage.removeItem("scrollPosition")),window.addEventListener("popstate",function(){window.scroll({top:0,left:0,behavior:"smooth"}),setTimeout(()=>{loadProductFromURL()},400)})}catch(r){console.error("Error initializing page:",r)}}),document.addEventListener("DOMContentLoaded",function(){try{history.scrollRestoration&&(history.scrollRestoration="auto"),forceScrollToTop(),loadProductFromURL(),setupProductLinks(),document.querySelector(".thumbnail")&&document.querySelector(".thumbnail").classList.add("active");let e=document.getElementById("modal-image");e&&(e.addEventListener("mousedown",startDrag),e.addEventListener("touchstart",startDrag,{passive:!1}),window.addEventListener("mousemove",drag),window.addEventListener("touchmove",drag,{passive:!1}),window.addEventListener("mouseup",endDrag),window.addEventListener("touchend",endDrag));let t=document.getElementById("image-modal");t&&t.addEventListener("click",function(e){e.target===t&&closeImageModal()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&"block"===t.style.display&&closeImageModal()});let o=0;e&&e.addEventListener("touchend",function(e){let t=new Date().getTime(),r=t-o;r<300&&r>0&&(1===zoomLevel?changeZoom(1):resetZoom(),e.preventDefault()),o=t}),document.addEventListener("keydown",function(e){let t=document.getElementById("image-modal");"block"===t.style.display&&("ArrowLeft"===e.key?(navigateImages(-1),e.preventDefault()):"ArrowRight"===e.key&&(navigateImages(1),e.preventDefault()))}),setupAccordion(),setupThumbnailScrolling(),document.querySelectorAll("img").forEach(e=>{e.onerror=function(){this.src="placeholder.jpg"}}),sessionStorage.getItem("scrollPosition")&&(window.scrollTo(0,parseInt(sessionStorage.getItem("scrollPosition"))),sessionStorage.removeItem("scrollPosition")),window.addEventListener("popstate",function(){window.scroll({top:0,left:0,behavior:"smooth"}),setTimeout(()=>{loadProductFromURL()},400)})}catch(r){console.error("Error initializing page:",r)}});let initialScrollPerformed=!1,userHasScrolled=!1;function forceScrollToTop(){!userHasScrolled&&(initialScrollPerformed||(initialScrollPerformed=!0,window.scrollTo(0,0)))}function navigateImages(e){let t=Array.from(document.querySelectorAll(".thumbnail"));document.getElementById("current-image");let o=t.findIndex(e=>e.classList.contains("active")),r=o+e;r<0?r=t.length-1:r>=t.length&&(r=0);let l=t[r].src;changeImage(l,e>0?"right":"left")}function closeImageModal(){let e=document.getElementById("image-modal");e.style.display="none",document.body.style.overflow="auto";let t=document.querySelector(".zoom-instructions");t&&t.classList.remove("show");let o=document.querySelector(".zoom-status");o&&o.classList.remove("show")}function ensureModalElements(){let e=document.querySelector(".modal-content");if(e){if(!document.querySelector(".zoom-instructions")){let t=document.createElement("div");t.className="zoom-instructions",t.innerHTML='<i class="fas fa-hand-pointer"></i> تمرير وتكبير الصورة باللمس',e.appendChild(t)}if(!document.querySelector(".zoom-status")){let o=document.createElement("div");o.className="zoom-status",e.appendChild(o)}}}function updateZoomStatus(){let e=document.querySelector(".zoom-status");e&&(e.textContent=`${Math.round(100*zoomLevel)}%`,e.classList.add("show"),timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(()=>{e.classList.remove("show")},1500))}function ensureModalElements(){let e=document.querySelector(".modal-content");if(e){if(!document.querySelector(".zoom-instructions")){let t=document.createElement("div");t.className="zoom-instructions",t.innerHTML='<i class="fas fa-hand-pointer"></i> تمرير وتكبير الصورة باللمس',e.appendChild(t)}if(!document.querySelector(".zoom-status")){let o=document.createElement("div");o.className="zoom-status",e.appendChild(o)}}}function setupMainImageTouch(){let e=document.getElementById("current-image"),t=document.querySelector(".main-image");if(!e||!t)return;let o=0,r=0;t.addEventListener("touchstart",function(e){o=e.touches[0].clientX},{passive:!0}),t.addEventListener("touchend",function(e){r=e.changedTouches[0].clientX,function e(){let t=r-o;50>Math.abs(t)||(t>0?navigateImages(-1):navigateImages(1))}()},{passive:!0})}document.addEventListener("DOMContentLoaded",function(){try{initialScrollPerformed=!1,forceScrollToTop(),window.addEventListener("scroll",function(){!userHasScrolled&&window.scrollY>5&&(userHasScrolled=!0)},{passive:!0}),setTimeout(()=>{userHasScrolled||window.scrollTo({top:0,left:0,behavior:"auto"})},100),window.addEventListener("load",function(){userHasScrolled||(initialScrollPerformed=!0,window.scrollTo({top:0,left:0,behavior:"auto"}))});let e=function(){try{let e=document.referrer.includes(window.location.host);e&&(userHasScrolled=!1,window.scrollTo(0,0)),loadProductFromURL()}catch(t){console.error("Error loading product:",t)}};document.querySelectorAll(".related-products .product-link").forEach(t=>{t.onclick=null,t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),userHasScrolled=!1,document.body.style.pointerEvents="none";let o=this.getAttribute("href"),r=new URLSearchParams(o.split("?")[1]).get("product");r?(history.pushState({},"",`?product=${r}`),window.scrollTo({top:0,left:0,behavior:"smooth"}),setTimeout(()=>{e(),document.body.style.pointerEvents="auto"},400)):document.body.style.pointerEvents="auto"}),t.style.cursor="pointer",t.style.webkitTapHighlightColor="transparent"})}catch(t){console.error("Error initializing page:",t)}}),window.addEventListener("popstate",function(){userHasScrolled=!1,window.scroll({top:0,left:0,behavior:"smooth"}),setTimeout(()=>{loadProductFromURL()},400)}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("modal-image"),t=document.querySelector(".zoom-container");e&&t&&(e.onload=function(){this.naturalHeight>this.naturalWidth?t.classList.add("vertical-image"):t.classList.remove("vertical-image"),centerModalImage()})}),document.addEventListener("DOMContentLoaded",function(){try{loadProductFromURL(),setupProductLinks(),setupMainImageTouch();let e=updateProductDisplay;updateProductDisplay=function(t){e(t),setTimeout(()=>{setupMainImageTouch()},200)}}catch(t){console.error("Error initializing page:",t)}}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("menu-toggle"),t=document.getElementById("sidebar-menu"),o=document.getElementById("sidebar-close"),r=document.getElementById("overlay"),l=document.querySelectorAll(".sidebar-category"),n=document.getElementById("category-popup"),a=document.getElementById("popup-close"),i=document.getElementById("popup-category-title"),s=document.getElementById("popup-products");function c(){t.classList.remove("open"),r.classList.remove("show"),document.body.style.overflow="auto"}function d(e){return window.products?window.products.filter(t=>t.category===e):[]}e.addEventListener("click",function(){t.classList.add("open"),r.classList.add("show"),document.body.style.overflow="hidden"}),o.addEventListener("click",c),r.addEventListener("click",c),l.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-category"),t=this.querySelector("span").textContent;i.textContent=t,function e(t){s.innerHTML="";let o=getCategoryProducts(t);o.forEach(e=>{let t=function e(t){let o=document.createElement("div");return o.className="popup-product",o.setAttribute("data-id",t.id),o.innerHTML=`
            <img src="${t.images[0]}" alt="${t.title}">
            <div class="popup-product-info">
                <h4 class="popup-product-title">${t.title}</h4>
                <div class="popup-product-price">${t.currentPrice} درهم</div>
            </div>
        `,o.addEventListener("click",function(){var e;let t=this.getAttribute("data-id");n.classList.remove("show"),c(),e=t,history.pushState({},"",`?product=${e}`),window.scrollTo({top:0,left:0,behavior:"smooth"}),setTimeout(()=>{loadProductFromURL()},400)}),o}(e);s.appendChild(t)})}(e),n.classList.add("show")})}),a.addEventListener("click",function(){n.classList.remove("show")})}),document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".modal"),t=document.querySelectorAll(".open-modal"),o=document.querySelectorAll(".close");t.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-modal"),t=document.getElementById(e);t&&(t.style.display="flex")})}),o.forEach(e=>{e.addEventListener("click",function(){let e=this.closest(".modal");e&&(e.style.display="none")})}),window.addEventListener("click",function(t){e.forEach(e=>{t.target===e&&(e.style.display="none")})})}),document.getElementById("contactForm1").addEventListener("submit",function(e){e.preventDefault();let t=document.getElementById("name1").value,o,r=`mailto:jouet-maroc@gmail.com?subject=رسالة من ${t}&body=${document.getElementById("message1").value}%0A%0Aالبريد الإلكتروني: ${document.getElementById("email1").value}`;window.location.href=r}),document.getElementById("whatsappSend1").addEventListener("click",function(){let e=document.getElementById("name1").value,t,o,r=`https://wa.me/212762609147?text=مرحبًا، أنا ${e}.%0Aالبريد الإلكتروني: ${document.getElementById("email1").value}.%0Aالرسالة: ${document.getElementById("message1").value}`;window.open(r,"_blank")}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();let t=this.getAttribute("href").substring(1),o=document.getElementById(t);o&&window.scrollTo({top:o.offsetTop,behavior:"smooth"})})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("newsletter-form"),t=document.getElementById("newsletter-success");e&&e.addEventListener("submit",function(o){o.preventDefault();let r=this.querySelector('input[type="email"]'),l=r.value;l&&l.includes("@")&&l.includes(".")&&(e.style.display="none",t.style.display="block",console.log("Newsletter subscription:",l),setTimeout(()=>{r.value="",e.style.display="flex",t.style.display="none"},5e3))})});let currentIndex=0,autoScroll;function scrollOffers(e){let t=document.querySelector(".offer-slider"),o=document.querySelectorAll(".offer-item"),r=o.length;"next"===e?currentIndex=currentIndex<r-1?currentIndex+1:0:"prev"===e&&(currentIndex=currentIndex>0?currentIndex-1:r-1);let l=-(100*currentIndex);t.style.transform=`translateX(${l}%)`}function startAutoScroll(){autoScroll=setInterval(()=>{scrollOffers("next")},4e3)}function stopAutoScroll(){clearInterval(autoScroll)}function showCategoryProducts(e){let t=document.getElementById("category-popup"),o=document.getElementById("popup-category-title"),r=document.getElementById("popup-products"),l=document.getElementById("overlay");o.textContent=getCategoryTitle(e),r.innerHTML="";let n=filterProductsByCategory(getCategoryName(e));if(0===n.length){let a=document.createElement("div");a.className="no-products-message",a.textContent="لا توجد منتجات في هذه الفئة حالياً",r.appendChild(a)}else n.forEach(e=>{let t=createProductElement(e);r.appendChild(t)});t.classList.add("show"),l.classList.add("show"),document.body.style.overflow="hidden"}function filterProductsByCategory(e){let t=window.products||[];console.log("جميع الفئات المتاحة:",t.map(e=>e.category).filter((e,t,o)=>o.indexOf(e)===t));let o=t.filter(t=>t.category===e);return console.log(`تم العثور على ${o.length} منتج في فئة "${e}"`),o}function createProductElement(e){let t=document.createElement("div");return t.className="popup-product",t.innerHTML=`
        <img src="${e.images[0]}" alt="${e.title}">
        <div class="popup-product-info">
            <h4 class="popup-product-title">${e.title}</h4>
            <div class="popup-product-price">${e.currentPrice} درهم</div>
        </div>
    `,t.addEventListener("click",function(){window.location.href=`?product=${e.id}`,document.getElementById("category-popup").classList.remove("show"),document.getElementById("overlay").classList.remove("show"),document.body.style.overflow="auto"}),t}document.addEventListener("DOMContentLoaded",startAutoScroll),document.querySelector(".offer-slider").addEventListener("mouseenter",stopAutoScroll),document.querySelector(".offer-slider").addEventListener("mouseleave",startAutoScroll),document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".desktop-category");e.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-category");(function e(t){var o;showCategoryProducts(t)})(e)})})}),document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".sidebar-category");e.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-category");document.getElementById("sidebar-menu").classList.remove("open"),showCategoryProducts(e)})});let t=document.querySelectorAll(".desktop-category");t.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-category");showCategoryProducts(e)})});let o=document.getElementById("popup-close");o&&o.addEventListener("click",function(){document.getElementById("category-popup").classList.remove("show"),document.getElementById("overlay").classList.remove("show"),document.body.style.overflow="auto"});let r=document.getElementById("overlay");r&&r.addEventListener("click",function(){let e=document.getElementById("category-popup");e.classList.contains("show")&&(e.classList.remove("show"),this.classList.remove("show"),document.body.style.overflow="auto")})});const searchInput=document.getElementById("search-input"),searchResults=document.getElementById("search-results"),productsGrid=document.getElementById("products-grid");function loadProducts(){products.forEach(e=>{let t=createProductCard(e);productsGrid.appendChild(t)})}function createProductCard(e){let t=document.createElement("a");return t.href=`?product=${encodeURIComponent(e.id)}`,t.className="product-link",t.innerHTML=`
        <div class="related-product">
            <img src="${e.images[0]}" alt="${e.title}">
            <h3>${e.title}</h3>
            <div class="related-price-container">
                <div class="related-price">${e.currentPrice} درهم</div>
                <div class="related-old-price">${e.oldPrice} درهم</div>
            </div>
            <div class="related-discount-badge">-${e.discount}%</div>
        </div>
    `,t}function displayResults(e){if(searchResults.innerHTML="",0===e.length){searchResults.innerHTML='<div class="no-results">لم يتم العثور على نتائج</div>',searchResults.style.display="block";return}e.forEach(e=>{let t=document.createElement("a");t.href=`?product=${encodeURIComponent(e.id)}`,t.classList.add("search-result-item"),t.innerHTML=`
            <img src="${e.images[0]}" alt="${e.title}" class="search-result-image">
            <div class="search-result-info">
                <div class="search-result-title">${highlightText(e.title,searchInput.value)}</div>
                <div class="search-result-price">${e.currentPrice} درهم</div>
                <div class="search-result-category">${e.category}</div>
            </div>
        `,searchResults.appendChild(t)}),searchResults.style.display="block"}function highlightText(e,t){let o=RegExp(`(${t})`,"gi");return e.replace(o,'<span class="highlighted">$1</span>')}function debounce(e,t){let o;return function(...r){clearTimeout(o),o=setTimeout(()=>e.apply(this,r),t)}}function performSearch(){let e=searchInput.value.trim().toLowerCase();if(""===e){searchResults.style.display="none";return}let t=products.filter(t=>t.title.toLowerCase().includes(e));displayResults(t)}const debouncedSearch=debounce(performSearch,300);function toggleChatWindow(){let e=document.getElementById("chatWindow");"none"===e.style.display||""===e.style.display?e.style.display="block":e.style.display="none"}function closeChatWindow(){let e=document.getElementById("chatWindow");e.style.display="none"}function toggleAnswer(e){let t=e.parentElement,o=t.querySelector(".faq-answer"),r=e.querySelector(".symbol");document.querySelectorAll(".faq-item").forEach(e=>{e!==t&&(e.querySelector(".faq-answer").classList.remove("show"),e.querySelector(".symbol").textContent="+")}),o.classList.toggle("show"),r.textContent=o.classList.contains("show")?"-":"+"}document.getElementById("search-button").addEventListener("click",e=>{e.preventDefault(),performSearch()}),searchInput.addEventListener("input",()=>{debouncedSearch()}),document.addEventListener("click",e=>{e.target.closest(".search-box")||(searchResults.style.display="none")}),window.addEventListener("DOMContentLoaded",()=>{loadProducts()}),document.addEventListener("DOMContentLoaded",function(){let e=document.querySelector(".modal"),t=document.querySelector(".close"),o=document.querySelector("#openModalButton");t.addEventListener("click",function t(){e.classList.remove("show"),e.classList.add("hide"),setTimeout(()=>{e.style.display="none"},300)}),o.addEventListener("click",function(){"none"!==e.style.display&&e.style.display||(e.classList.remove("hide"),e.classList.add("show"),e.style.display="flex")})});